<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>Boost Meta State Machine - Dependency Injection Extension</title>
<link rel="stylesheet" href="../../style/boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.78.1">
<link rel="home" href="../../index.html" title="Boost.DI / C++14 Dependency Injection Library / 1.0.0">
<link rel="up" href="../projects.html" title="Projects">
<link rel="prev" href="../projects.html" title="Projects">
<link rel="next" href="match_3_switcher_game.html" title="Match-3 Switcher Game">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr>
<td valign="top"><img alt="Boost C++ Libraries" width="277" height="86" src="../../../../../../boost.png"></td>
<td align="center"><a href="../../../../../../index.html">Home</a></td>
<td align="center"><a href="../../../../../../libs/libraries.htm">Libraries</a></td>
<td align="center"><a href="http://www.boost.org/users/people.html">People</a></td>
<td align="center"><a href="http://www.boost.org/users/faq.html">FAQ</a></td>
<td align="center"><a href="../../../../../../more/index.htm">More</a></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="../projects.html"><img src="../../../../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../projects.html"><img src="../../../../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../../../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="match_3_switcher_game.html"><img src="../../../../../../doc/src/images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="di.projects.boost_meta_state_machine_depende"></a><a class="link" href="boost_meta_state_machine_depende.html" title="Boost Meta State Machine - Dependency Injection Extension">Boost Meta
      State Machine - Dependency Injection Extension</a>
</h3></div></div></div>
<p>
        <a href="https://github.com/krzysztof-jusiak/msm" target="_top">https://github.com/krzysztof-jusiak/msm</a>
      </p>
<p>
        <a href="http://www.boost.org/doc/libs/1_55_0/libs/msm/doc/HTML/index.html" target="_top">Boost
        Meta State Machine</a> is a library allowing you to easily and quickly
        define state machines of very high performance. <code class="computeroutput"><span class="identifier">Boost</span><span class="special">.</span><span class="identifier">MSM</span></code> is
        a great library, unfortunately <code class="computeroutput"><span class="identifier">actions</span></code>/<code class="computeroutput"><span class="identifier">guards</span></code> have to have empty constructor and
        whole logic has to be handled via Finite State Machine. Such approach is
        hard to maintain and test. Would be great to have possibility to implement
        <code class="computeroutput"><span class="identifier">action</span></code>/<code class="computeroutput"><span class="identifier">guards</span></code>
        without FSM dependency and with proper dependency injection instead. Such
        functionality might be achieved with <code class="computeroutput"><span class="identifier">Boost</span><span class="special">.</span><span class="identifier">DI</span></code> and
        it's presented below.
      </p>
<p>
        For example purposes let's assume we have two states, event and data ready.
      </p>
<pre class="programlisting"><span class="keyword">struct</span> <span class="identifier">event</span> <span class="special">:</span> <span class="identifier">euml_event</span><span class="special">&lt;</span><span class="identifier">event</span><span class="special">&gt;</span> <span class="special">{</span> <span class="special">};</span>

<span class="keyword">struct</span> <span class="identifier">state1</span> <span class="special">:</span> <span class="identifier">state</span><span class="special">&lt;&gt;,</span> <span class="identifier">euml_state</span><span class="special">&lt;</span><span class="identifier">state1</span><span class="special">&gt;</span> <span class="special">{</span> <span class="special">};</span>
<span class="keyword">struct</span> <span class="identifier">state2</span> <span class="special">:</span> <span class="identifier">state</span><span class="special">&lt;&gt;,</span> <span class="identifier">euml_state</span><span class="special">&lt;</span><span class="identifier">state2</span><span class="special">&gt;</span> <span class="special">{</span> <span class="special">};</span>

<span class="keyword">struct</span> <span class="identifier">data</span> <span class="special">{</span>
    <span class="keyword">bool</span> <span class="identifier">flag</span> <span class="special">=</span> <span class="keyword">false</span><span class="special">;</span>
<span class="special">};</span>
</pre>
<p>
        Below table presents comparison between simple state machine - Boost.MSM-eUML
        without usage of <code class="computeroutput"><span class="identifier">actions</span></code>/<code class="computeroutput"><span class="identifier">guards</span></code> dependency injection and with dependency
        injection. Without dependency injection all logic has to published by <code class="computeroutput"><span class="identifier">FSM</span></code> itself, which makes it really hard
        to test. FSM has to be tested itself due to public methods, <code class="computeroutput"><span class="identifier">actions</span></code>/<code class="computeroutput"><span class="identifier">guards</span></code>
        tests require FSM fake in order to unit test them properly. Such approach
        breaks <a href="http://en.wikipedia.org/wiki/Law_of_Demeter" target="_top">Law of Demeter</a>
        principle as well. Most of the time <code class="computeroutput"><span class="identifier">source</span></code>
        and <code class="computeroutput"><span class="identifier">target</span></code> states are not
        very useful, because we don't want them to keep common data. With dependency
        injection we have easier life - <code class="computeroutput"><span class="identifier">actions</span></code>/<code class="computeroutput"><span class="identifier">guards</span></code> can be easily tested in separation.
        <code class="computeroutput"><span class="identifier">FSM</span></code> doesn't have to be tested
        at all, due to lack of any logic - despite declarative transition table definition.
        <code class="computeroutput"><span class="identifier">Actions</span></code>/<code class="computeroutput"><span class="identifier">guards</span></code>
        constructor signature change may not break the compilation as well. Imagine
        that one action requires to to send a message, so let's say <code class="computeroutput"><span class="identifier">message_sender</span></code> dependency was passed into
        it. If any other <code class="computeroutput"><span class="identifier">guard</span></code> or
        <code class="computeroutput"><span class="identifier">action</span></code> will require it as
        well, the only thing which has to be done is to change the constructor signature
        of the <code class="computeroutput"><span class="identifier">action</span></code> or <code class="computeroutput"><span class="identifier">guard</span></code>.
      </p>
<div class="informaltable"><table class="table">
<colgroup>
<col>
<col>
</colgroup>
<thead><tr>
<th>
                <p>
                  <code class="computeroutput"><span class="identifier">Boost</span><span class="special">.</span><span class="identifier">MSM</span> <span class="identifier">eUML</span></code>
                </p>
              </th>
<th>
                <p>
                  <code class="computeroutput"><span class="identifier">Boost</span><span class="special">.</span><span class="identifier">MSM</span> <span class="identifier">eUML</span>
                  <span class="identifier">with</span> <span class="identifier">Boost</span><span class="special">.</span><span class="identifier">DI</span></code>
                </p>
              </th>
</tr></thead>
<tbody><tr>
<td>
<pre xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" class="table-programlisting"><span class="keyword">class</span> <span class="identifier">guard</span> <span class="special">:</span> <span class="keyword">public</span> <span class="identifier">euml_action</span><span class="special">&lt;</span><span class="identifier">guard</span><span class="special">&gt;</span> <span class="special">{</span>
<span class="keyword">public</span><span class="special">:</span>
    <span class="keyword">template</span><span class="special">&lt;</span>
        <span class="keyword">typename</span> <span class="identifier">TFsm</span>
      <span class="special">,</span> <span class="keyword">typename</span> <span class="identifier">TEvent</span>
      <span class="special">,</span> <span class="keyword">typename</span> <span class="identifier">TSourceState</span> <span class="comment">// not used</span>
      <span class="special">,</span> <span class="keyword">typename</span> <span class="identifier">TTargetState</span> <span class="comment">// not used</span>
    <span class="special">&gt;</span>
    <span class="keyword">bool</span> <span class="keyword">operator</span><span class="special">()(</span><span class="keyword">const</span> <span class="identifier">TEvent</span><span class="special">&amp;,</span> <span class="identifier">TFsm</span><span class="special">&amp;</span> <span class="identifier">fsm</span><span class="special">,</span> <span class="identifier">TSourceState</span><span class="special">&amp;,</span> <span class="identifier">TTargetState</span><span class="special">&amp;)</span> <span class="keyword">const</span> <span class="special">{</span>
        <span class="keyword">return</span> <span class="identifier">fsm</span><span class="special">.</span><span class="identifier">get_data</span><span class="special">()-&gt;</span><span class="identifier">flag</span><span class="special">;</span> <span class="comment">// data has to be taken from FSM (breaks law of demeter)</span>
    <span class="special">}</span>
<span class="special">};</span>

<span class="keyword">class</span> <span class="identifier">action</span> <span class="special">:</span> <span class="keyword">public</span> <span class="identifier">euml_action</span><span class="special">&lt;</span><span class="identifier">action</span><span class="special">&gt;</span> <span class="special">{</span>
<span class="keyword">public</span><span class="special">:</span>
    <span class="keyword">template</span><span class="special">&lt;</span>
        <span class="keyword">typename</span> <span class="identifier">TFsm</span>
      <span class="special">,</span> <span class="keyword">typename</span> <span class="identifier">TEvent</span>
      <span class="special">,</span> <span class="keyword">typename</span> <span class="identifier">TSourceState</span> <span class="comment">// not used</span>
      <span class="special">,</span> <span class="keyword">typename</span> <span class="identifier">TTargetState</span> <span class="comment">// not used</span>
    <span class="special">&gt;</span>
    <span class="keyword">void</span> <span class="keyword">operator</span><span class="special">()(</span><span class="keyword">const</span> <span class="identifier">TEvent</span><span class="special">&amp;,</span> <span class="identifier">TFsm</span><span class="special">&amp;</span> <span class="identifier">fsm</span><span class="special">,</span> <span class="identifier">TSourceState</span><span class="special">&amp;,</span> <span class="identifier">TTargetState</span><span class="special">&amp;)</span> <span class="special">{</span>
        <span class="identifier">fsm</span><span class="special">.</span><span class="identifier">get_data</span><span class="special">()-&gt;</span><span class="identifier">flag</span> <span class="special">=</span> <span class="keyword">true</span><span class="special">;</span> <span class="comment">// data has to be taken from FSM (breaks law of demeter)</span>
    <span class="special">}</span>
<span class="special">};</span>

<span class="keyword">class</span> <span class="identifier">state_machine_</span> <span class="special">:</span> <span class="keyword">public</span> <span class="identifier">state_machine_def</span><span class="special">&lt;</span><span class="identifier">state_machine_</span><span class="special">&gt;</span> <span class="special">{</span>
<span class="keyword">public</span><span class="special">:</span>
    <span class="keyword">using</span> <span class="identifier">initial_state</span> <span class="special">=</span> <span class="identifier">state1</span><span class="special">;</span>

    <span class="identifier">state_machine_</span><span class="special">()</span>
        <span class="special">:</span> <span class="identifier">data_</span><span class="special">(</span><span class="keyword">new</span> <span class="identifier">data</span><span class="special">())</span>
    <span class="special">{</span> <span class="special">}</span>

    <span class="identifier">BOOST_MSM_EUML_DECLARE_TRANSITION_TABLE</span><span class="special">((</span>
        <span class="identifier">state1</span><span class="special">()</span> <span class="special">+</span> <span class="identifier">event</span><span class="special">()</span> <span class="special">/</span> <span class="identifier">action</span><span class="special">()</span>
      <span class="special">,</span> <span class="identifier">state1</span><span class="special">()</span> <span class="special">+</span> <span class="identifier">event</span><span class="special">()</span> <span class="special">[</span><span class="identifier">guard</span><span class="special">()]</span> <span class="special">==</span> <span class="identifier">state2</span><span class="special">()</span>
    <span class="special">),</span> <span class="identifier">transition_table</span><span class="special">)</span>

    <span class="identifier">shared_ptr</span><span class="special">&lt;</span><span class="identifier">data</span><span class="special">&gt;</span> <span class="identifier">get_data</span><span class="special">()</span> <span class="keyword">const</span> <span class="special">{</span> <span class="keyword">return</span> <span class="identifier">data_</span><span class="special">;</span> <span class="special">}</span> <span class="comment">// public method to get data</span>

<span class="keyword">private</span><span class="special">:</span>
    <span class="identifier">shared_ptr</span><span class="special">&lt;</span><span class="identifier">data</span><span class="special">&gt;</span> <span class="identifier">data_</span><span class="special">;</span>
<span class="special">};</span>

<span class="keyword">using</span> <span class="identifier">state_machine</span> <span class="special">=</span> <span class="identifier">back</span><span class="special">::</span><span class="identifier">state_machine</span><span class="special">&lt;</span><span class="identifier">state_machine_</span><span class="special">&gt;;</span>

<span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span> <span class="special">{</span>
    <span class="identifier">state_machine</span> <span class="identifier">sm</span><span class="special">;</span>
    <span class="identifier">sm</span><span class="special">.</span><span class="identifier">process_event</span><span class="special">(</span><span class="identifier">event</span><span class="special">());</span>
    <span class="identifier">assert</span><span class="special">(</span><span class="number">0</span> <span class="special">==</span> <span class="special">*</span><span class="identifier">sm</span><span class="special">.</span><span class="identifier">current_state</span><span class="special">());</span>
    <span class="identifier">sm</span><span class="special">.</span><span class="identifier">process_event</span><span class="special">(</span><span class="identifier">event</span><span class="special">());</span>
    <span class="identifier">assert</span><span class="special">(</span><span class="number">1</span> <span class="special">==</span> <span class="special">*</span><span class="identifier">sm</span><span class="special">.</span><span class="identifier">current_state</span><span class="special">());</span>

    <span class="keyword">return</span> <span class="number">0</span><span class="special">;</span>
<span class="special">}</span>
</pre>
              </td>
<td>
<pre xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" class="table-programlisting"><span class="keyword">class</span> <span class="identifier">guard</span> <span class="special">:</span> <span class="keyword">public</span> <span class="identifier">euml_action</span><span class="special">&lt;</span><span class="identifier">guard</span><span class="special">&gt;</span> <span class="special">{</span>
<span class="keyword">public</span><span class="special">:</span>
    <span class="keyword">explicit</span> <span class="identifier">guard</span><span class="special">(</span><span class="identifier">shared_ptr</span><span class="special">&lt;</span><span class="identifier">data</span><span class="special">&gt;</span> <span class="identifier">data</span> <span class="special">=</span> <span class="keyword">nullptr</span><span class="special">)</span> <span class="comment">// default constructor is required by eUML</span>
        <span class="special">:</span> <span class="identifier">data</span><span class="special">(</span><span class="identifier">data</span><span class="special">)</span>
    <span class="special">{</span> <span class="special">}</span>

    <span class="keyword">template</span><span class="special">&lt;</span><span class="keyword">typename</span> <span class="identifier">TEvent</span><span class="special">&gt;</span>
    <span class="keyword">bool</span> <span class="keyword">operator</span><span class="special">()(</span><span class="keyword">const</span> <span class="identifier">TEvent</span><span class="special">&amp;)</span> <span class="keyword">const</span> <span class="special">{</span>
        <span class="keyword">return</span> <span class="identifier">data</span><span class="special">-&gt;</span><span class="identifier">flag</span><span class="special">;</span>
    <span class="special">}</span>

<span class="keyword">private</span><span class="special">:</span>
    <span class="identifier">shared_ptr</span><span class="special">&lt;</span><span class="identifier">data</span><span class="special">&gt;</span> <span class="identifier">data</span><span class="special">;</span>
<span class="special">};</span>

<span class="keyword">class</span> <span class="identifier">action</span> <span class="special">:</span> <span class="keyword">public</span> <span class="identifier">euml_action</span><span class="special">&lt;</span><span class="identifier">action</span><span class="special">&gt;</span> <span class="special">{</span>
<span class="keyword">public</span><span class="special">:</span>
    <span class="keyword">explicit</span> <span class="identifier">action</span><span class="special">(</span><span class="identifier">shared_ptr</span><span class="special">&lt;</span><span class="identifier">data</span><span class="special">&gt;</span> <span class="identifier">data</span> <span class="special">=</span> <span class="keyword">nullptr</span><span class="special">)</span> <span class="comment">// default constructor is required by eUML</span>
        <span class="special">:</span> <span class="identifier">data</span><span class="special">(</span><span class="identifier">data</span><span class="special">)</span>
    <span class="special">{</span> <span class="special">}</span>

    <span class="keyword">template</span><span class="special">&lt;</span><span class="keyword">typename</span> <span class="identifier">TEvent</span><span class="special">&gt;</span>
    <span class="keyword">void</span> <span class="keyword">operator</span><span class="special">()(</span><span class="keyword">const</span> <span class="identifier">TEvent</span><span class="special">&amp;)</span> <span class="special">{</span>
        <span class="identifier">data</span><span class="special">-&gt;</span><span class="identifier">flag</span> <span class="special">=</span> <span class="keyword">true</span><span class="special">;</span>
    <span class="special">}</span>

<span class="keyword">private</span><span class="special">:</span>
    <span class="identifier">shared_ptr</span><span class="special">&lt;</span><span class="identifier">data</span><span class="special">&gt;</span> <span class="identifier">data</span><span class="special">;</span>
<span class="special">};</span>

<span class="keyword">struct</span> <span class="identifier">state_machine_</span> <span class="special">:</span> <span class="identifier">state_machine_def</span><span class="special">&lt;</span><span class="identifier">state_machine_</span><span class="special">&gt;</span> <span class="special">{</span>
    <span class="keyword">using</span> <span class="identifier">initial_state</span> <span class="special">=</span> <span class="identifier">state1</span><span class="special">;</span>

    <span class="identifier">BOOST_MSM_EUML_DECLARE_TRANSITION_TABLE</span><span class="special">((</span>
        <span class="identifier">state1</span><span class="special">()</span> <span class="special">+</span> <span class="identifier">event</span><span class="special">()</span> <span class="special">/</span> <span class="identifier">action</span><span class="special">()</span>
      <span class="special">,</span> <span class="identifier">state1</span><span class="special">()</span> <span class="special">+</span> <span class="identifier">event</span><span class="special">()</span> <span class="special">[</span><span class="identifier">guard</span><span class="special">()]</span> <span class="special">==</span> <span class="identifier">state2</span><span class="special">()</span>
    <span class="special">),</span> <span class="identifier">transition_table</span><span class="special">)</span>
<span class="special">};</span>

<span class="keyword">using</span> <span class="identifier">state_machine</span> <span class="special">=</span> <span class="identifier">back</span><span class="special">::</span><span class="identifier">state_machine</span><span class="special">&lt;</span>
    <span class="identifier">state_machine_</span>
  <span class="special">,</span> <span class="identifier">back</span><span class="special">::</span><span class="identifier">use_dependency_injection</span> <span class="comment">// Boost.DI dependency injection policy</span>
<span class="special">&gt;;</span>

<span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span> <span class="special">{</span>
    <span class="keyword">auto</span> <span class="identifier">sm</span> <span class="special">=</span> <span class="identifier">di</span><span class="special">::</span><span class="identifier">make_injector</span><span class="special">().</span><span class="identifier">create</span><span class="special">&lt;</span><span class="identifier">state_machine</span><span class="special">&gt;();</span>
    <span class="identifier">sm</span><span class="special">.</span><span class="identifier">process_event</span><span class="special">(</span><span class="identifier">event</span><span class="special">());</span>
    <span class="identifier">assert</span><span class="special">(</span><span class="number">0</span> <span class="special">==</span> <span class="special">*</span><span class="identifier">sm</span><span class="special">.</span><span class="identifier">current_state</span><span class="special">());</span>
    <span class="identifier">sm</span><span class="special">.</span><span class="identifier">process_event</span><span class="special">(</span><span class="identifier">event</span><span class="special">());</span>
    <span class="identifier">assert</span><span class="special">(</span><span class="number">1</span> <span class="special">==</span> <span class="special">*</span><span class="identifier">sm</span><span class="special">.</span><span class="identifier">current_state</span><span class="special">());</span>

    <span class="keyword">return</span> <span class="number">0</span><span class="special">;</span>
<span class="special">}</span>
</pre>
              </td>
</tr></tbody>
</table></div>
<p>
        In order to support dependency injection, few changes to <code class="computeroutput"><span class="identifier">Boost</span><span class="special">.</span><span class="identifier">MSM</span></code> were
        made.
      </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
            List of <code class="computeroutput"><span class="identifier">actions</span></code>/<code class="computeroutput"><span class="identifier">guards</span></code> was generated from transition
            table
          </li>
<li class="listitem">
            Generated list was passed into state machine constructor
          </li>
<li class="listitem">
            Policy <code class="computeroutput"><span class="identifier">use_dependency_injection</span></code>
            was added
          </li>
</ul></div>
<p>
        Such approach allows to easy test State Machine by simulating actions/guards
        behaviour.
      </p>
<pre class="programlisting"><span class="keyword">struct</span> <span class="identifier">state_machine_</span> <span class="special">:</span> <span class="keyword">public</span> <span class="identifier">state_machine_def</span><span class="special">&lt;</span><span class="identifier">state_machine_</span><span class="special">&gt;</span> <span class="special">{</span>
    <span class="keyword">using</span> <span class="identifier">initial_state</span> <span class="special">=</span> <span class="identifier">state1</span><span class="special">;</span>

    <span class="identifier">BOOST_MSM_EUML_DECLARE_TRANSITION_TABLE</span><span class="special">((</span>
        <span class="identifier">state2</span><span class="special">()</span> <span class="special">==</span> <span class="identifier">state1</span><span class="special">()</span> <span class="special">+</span> <span class="identifier">event1</span><span class="special">()</span> <span class="special">[</span><span class="identifier">guard</span><span class="special">()]</span> <span class="special">/</span> <span class="identifier">action</span><span class="special">()</span>
      <span class="special">,</span> <span class="identifier">state1</span><span class="special">()</span> <span class="special">==</span> <span class="identifier">state2</span><span class="special">()</span> <span class="special">+</span> <span class="identifier">event2</span><span class="special">()</span> <span class="special">[</span><span class="identifier">guard</span><span class="special">()</span> <span class="special">&amp;&amp;</span> <span class="identifier">guard2</span><span class="special">()]</span> <span class="special">/</span> <span class="special">(</span><span class="identifier">action</span><span class="special">(),</span> <span class="identifier">action2</span><span class="special">())</span>
    <span class="special">),</span> <span class="identifier">transition_table</span><span class="special">)</span>
<span class="special">};</span>

<span class="keyword">using</span> <span class="identifier">state_machine</span> <span class="special">=</span> <span class="identifier">back</span><span class="special">::</span><span class="identifier">state_machine</span><span class="special">&lt;</span>
    <span class="identifier">state_machine_</span>
  <span class="special">,</span> <span class="identifier">back</span><span class="special">::</span><span class="identifier">use_dependency_injection_for_test</span> <span class="comment">// Boost.DI dependency injection policy for tests</span>
<span class="special">&gt;;</span>

<span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span> <span class="special">{</span>
    <span class="identifier">state_machine</span> <span class="identifier">sm</span><span class="special">;</span>

    <span class="comment">// test transition to state2 after event1 when</span>
    <span class="comment">// guard returns true with action</span>
    <span class="special">{</span>
        <span class="identifier">test</span><span class="special">::</span><span class="identifier">expectations</span><span class="special">&lt;</span><span class="identifier">state_machine</span><span class="special">&gt;</span> <span class="identifier">ex</span><span class="special">(</span><span class="identifier">sm</span><span class="special">);</span>
        <span class="identifier">ex</span><span class="special">.</span><span class="identifier">call</span><span class="special">&lt;</span><span class="identifier">guard</span><span class="special">&gt;().</span><span class="identifier">will_return</span><span class="special">(</span><span class="keyword">true</span><span class="special">);</span>
        <span class="identifier">ex</span><span class="special">.</span><span class="identifier">call</span><span class="special">&lt;</span><span class="identifier">action</span><span class="special">&gt;().</span><span class="identifier">times</span><span class="special">(</span><span class="number">1</span><span class="special">);</span>
        <span class="identifier">ex</span><span class="special">.</span><span class="identifier">state</span><span class="special">&lt;</span><span class="identifier">state2</span><span class="special">&gt;();</span>

        <span class="identifier">sm</span><span class="special">.</span><span class="identifier">process_event</span><span class="special">(</span><span class="identifier">event1</span><span class="special">());</span>
    <span class="special">}</span>

    <span class="comment">// test transition back to state1 after event2 when</span>
    <span class="comment">// guard and guard2 return true with action and action2</span>
    <span class="special">{</span>
        <span class="identifier">test</span><span class="special">::</span><span class="identifier">expectations</span><span class="special">&lt;</span><span class="identifier">state_machine</span><span class="special">&gt;</span> <span class="identifier">ex</span><span class="special">(</span><span class="identifier">sm</span><span class="special">);</span>
        <span class="identifier">ex</span><span class="special">.</span><span class="identifier">call</span><span class="special">&lt;</span><span class="identifier">guard</span><span class="special">&gt;().</span><span class="identifier">will_return</span><span class="special">(</span><span class="keyword">true</span><span class="special">);</span>
        <span class="identifier">ex</span><span class="special">.</span><span class="identifier">call</span><span class="special">&lt;</span><span class="identifier">guard2</span><span class="special">&gt;().</span><span class="identifier">will_return</span><span class="special">(</span><span class="keyword">true</span><span class="special">);</span>
        <span class="identifier">ex</span><span class="special">.</span><span class="identifier">call</span><span class="special">&lt;</span><span class="identifier">action</span><span class="special">&gt;().</span><span class="identifier">times</span><span class="special">(</span><span class="number">1</span><span class="special">);</span>
        <span class="identifier">ex</span><span class="special">.</span><span class="identifier">call</span><span class="special">&lt;</span><span class="identifier">action2</span><span class="special">&gt;().</span><span class="identifier">times</span><span class="special">(</span><span class="number">1</span><span class="special">);</span>
        <span class="identifier">ex</span><span class="special">.</span><span class="identifier">state</span><span class="special">&lt;</span><span class="identifier">state1</span><span class="special">&gt;();</span>

        <span class="identifier">sm</span><span class="special">.</span><span class="identifier">process_event</span><span class="special">(</span><span class="identifier">event2</span><span class="special">());</span>
    <span class="special">}</span>

    <span class="keyword">return</span> <span class="number">0</span><span class="special">;</span>
<span class="special">}</span>
</pre>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../../../../../doc/src/images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>
          Only <code class="computeroutput"><span class="identifier">Boost</span><span class="special">.</span><span class="identifier">MSM</span><span class="special">-</span><span class="identifier">eUML</span></code> front end was tested and adopted
          to this approach.
        </p></td></tr>
</table></div>
<p>
        Full example and implementation might be found in <a href="https://github.com/krzysztof-jusiak/msm" target="_top">Boost
        Meta State Machine with Dependency Injection</a>.
      </p>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2012-2015 Krzysztof
      Jusiak | Distributed under the Boost Software License, Version 1.0.</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="../projects.html"><img src="../../../../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../projects.html"><img src="../../../../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../../../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="match_3_switcher_game.html"><img src="../../../../../../doc/src/images/next.png" alt="Next"></a>
</div>
</body>
</html>
