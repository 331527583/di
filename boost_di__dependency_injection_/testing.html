<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>Testing</title>
<link rel="stylesheet" href=".././doc/src/boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.78.0">
<link rel="home" href="../index.html" title="Chapter&#160;1.&#160;Boost.DI (Dependency Injection) 1.0">
<link rel="up" href="../index.html" title="Chapter&#160;1.&#160;Boost.DI (Dependency Injection) 1.0">
<link rel="prev" href="policies.html" title="Policies">
<link rel="next" href="examples.html" title="Examples">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr>
<td valign="top"><img alt="Boost C++ Libraries" width="277" height="86" src=".././boost.png"></td>
<td align="center"><a href=".././index.html">Home</a></td>
<td align="center"><a href=".././libs/libraries.htm">Libraries</a></td>
<td align="center"><a href="http://www.boost.org/users/people.html">People</a></td>
<td align="center"><a href="http://www.boost.org/users/faq.html">FAQ</a></td>
<td align="center"><a href=".././more/index.htm">More</a></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="policies.html"><img src=".././doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src=".././doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src=".././doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="examples.html"><img src=".././doc/src/images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="boost_di__dependency_injection_.testing"></a><a class="link" href="testing.html" title="Testing">Testing</a>
</h2></div></div></div>
<div class="toc"><dl class="toc">
<dt><span class="section"><a href="testing.html#boost_di__dependency_injection_.testing.unit_tests">Unit
      Tests</a></span></dt>
<dt><span class="section"><a href="testing.html#boost_di__dependency_injection_.testing.integration_tests">Integration
      Tests</a></span></dt>
</dl></div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="boost_di__dependency_injection_.testing.unit_tests"></a><a class="link" href="testing.html#boost_di__dependency_injection_.testing.unit_tests" title="Unit Tests">Unit
      Tests</a>
</h3></div></div></div>
<p>
        For Unit Tests Dependency Injection Framework is not really needed. It's
        enough that usage of Dependency Injection make possible to pass dependencies
        via constructor. Thanks to that we can easily pass fakes and test our class
        in isolation.
      </p>
<p>
</p>
<pre class="programlisting"><span class="keyword">class</span> <span class="identifier">example</span> <span class="special">{</span>
<span class="keyword">public</span><span class="special">:</span>
    <span class="identifier">example</span><span class="special">(</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">shared_ptr</span><span class="special">&lt;</span><span class="identifier">ilogic</span><span class="special">&gt;,</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">shared_ptr</span><span class="special">&lt;</span><span class="identifier">ilogger</span><span class="special">&gt;);</span>

    <span class="keyword">void</span> <span class="identifier">run</span><span class="special">()</span> <span class="special">{</span>
        <span class="identifier">logic_</span><span class="special">-&gt;</span><span class="identifier">do_it</span><span class="special">();</span>
        <span class="identifier">logger_</span><span class="special">-&gt;</span><span class="identifier">log</span><span class="special">(</span><span class="string">"hello world"</span><span class="special">);</span>
    <span class="special">}</span>

    <span class="special">...</span>
<span class="special">};</span>
</pre>
<p>
      </p>
<p>
        To test <code class="computeroutput"><span class="identifier">example</span></code> we just need
        fakes for <code class="computeroutput"><span class="identifier">ilogic</span></code> and <code class="computeroutput"><span class="identifier">ilogger</span></code> and pass them to constructor.
      </p>
<p>
</p>
<pre class="programlisting"><span class="keyword">void</span> <span class="identifier">test_example</span><span class="special">()</span> <span class="special">{</span>
    <span class="keyword">auto</span> <span class="identifier">logic_mock</span> <span class="special">=</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">make_shared</span><span class="special">&lt;</span><span class="identifier">logic_mock</span><span class="special">&gt;();</span>
    <span class="keyword">auto</span> <span class="identifier">logger_mock</span> <span class="special">=</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">make_shared</span><span class="special">&lt;</span><span class="identifier">logger_mock</span><span class="special">&gt;();</span>

    <span class="identifier">example</span> <span class="identifier">sut</span><span class="special">((</span><span class="identifier">logic_mock</span><span class="special">,</span> <span class="identifier">logger_mock</span><span class="special">));</span>

    <span class="identifier">EXPECT_CALL</span><span class="special">(*</span><span class="identifier">logic_mock</span><span class="special">,</span> <span class="identifier">do_it</span><span class="special">());</span>
    <span class="identifier">EXPECT_CALL</span><span class="special">(*</span><span class="identifier">logger_mock</span><span class="special">,</span> <span class="identifier">log</span><span class="special">(</span><span class="string">"hello world"</span><span class="special">));</span>

    <span class="identifier">sut</span><span class="special">.</span><span class="identifier">run</span><span class="special">();</span>
<span class="special">}</span>
</pre>
<p>
      </p>
<p>
        That's it, Dependency Injection make unit-testing straight forward. Nevertheless
        to avoid writing boilerplate code like below example (avoid factory for object
        and repetitions of mocks creation)...
      </p>
<p>
</p>
<pre class="programlisting"><span class="keyword">class</span> <span class="identifier">example_test</span> <span class="special">{</span>
<span class="keyword">public</span><span class="special">:</span>
    <span class="keyword">void</span> <span class="identifier">set_up</span><span class="special">()</span> <span class="special">{</span>
        <span class="identifier">logic_mock_</span><span class="special">.</span><span class="identifier">reset</span><span class="special">(</span><span class="keyword">new</span> <span class="identifier">logic_mock</span><span class="special">());</span>
        <span class="identifier">logger_mock_</span><span class="special">.</span><span class="identifier">reset</span><span class="special">(</span><span class="keyword">new</span> <span class="identifier">logger_mock</span><span class="special">());</span>
    <span class="special">}</span>

    <span class="keyword">void</span> <span class="identifier">tear_down</span><span class="special">()</span> <span class="special">{</span> <span class="special">}</span>

    <span class="keyword">void</span> <span class="identifier">test_example</span><span class="special">()</span> <span class="special">{</span>
        <span class="identifier">example</span> <span class="identifier">sut</span><span class="special">((</span><span class="identifier">logic_mock_</span><span class="special">,</span> <span class="identifier">logger_mock_</span><span class="special">));</span>

        <span class="identifier">EXPECT_CALL</span><span class="special">(*</span><span class="identifier">logic_mock</span><span class="special">,</span> <span class="identifier">do_it</span><span class="special">());</span>
        <span class="identifier">EXPECT_CALL</span><span class="special">(*</span><span class="identifier">logger_mock</span><span class="special">,</span> <span class="identifier">log</span><span class="special">(</span><span class="string">"hello world"</span><span class="special">));</span>

        <span class="identifier">sut</span><span class="special">.</span><span class="identifier">run</span><span class="special">();</span>
    <span class="special">}</span>

    <span class="identifier">std</span><span class="special">::</span><span class="identifier">shared_ptr</span><span class="special">&lt;</span><span class="identifier">iloggic</span><span class="special">&gt;</span> <span class="identifier">logic_mock_</span><span class="special">;</span>
    <span class="identifier">std</span><span class="special">::</span><span class="identifier">shared_ptr</span><span class="special">&lt;</span><span class="identifier">ilogger</span><span class="special">&gt;</span> <span class="identifier">logger_mock</span><span class="special">;</span>
<span class="special">};</span>
</pre>
<p>
      </p>
<p>
        ... we can take full advantage of <code class="computeroutput"><span class="identifier">Boost</span><span class="special">.</span><span class="identifier">DI</span></code> and
        generate required mocks for us.
      </p>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src=".././doc/src/images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>
          <a href="https://github.com/dascandy/hippomocks" target="_top">HippoMocks</a>
          was used as Mocking library.
        </p></td></tr>
</table></div>
<p>
        So our example might be refactored to.
</p>
<pre class="programlisting"><span class="keyword">void</span> <span class="identifier">test_example</span><span class="special">()</span> <span class="special">{</span>
    <span class="keyword">auto</span> <span class="identifier">mi</span> <span class="special">=</span> <span class="identifier">di</span><span class="special">::</span><span class="identifier">make_mocks_injector</span><span class="special">();</span>

    <span class="identifier">EXPECT_CALL</span><span class="special">(</span><span class="identifier">mi</span><span class="special">,</span> <span class="identifier">ilogic</span><span class="special">::</span><span class="identifier">do_it</span><span class="special">);</span>
    <span class="identifier">EXPECT_CALL</span><span class="special">(</span><span class="identifier">mi</span><span class="special">,</span> <span class="identifier">ilogger</span><span class="special">::</span><span class="identifier">log</span><span class="special">).</span><span class="identifier">With</span><span class="special">(</span><span class="string">"hello world"</span><span class="special">);</span>

    <span class="identifier">mi</span><span class="special">.</span><span class="identifier">create</span><span class="special">&lt;</span><span class="identifier">example</span><span class="special">&gt;().</span><span class="identifier">run</span><span class="special">();</span>
<span class="special">}</span>
</pre>
<p>
      </p>
<p>
        Above example has few advantages
      </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
            Insensitive for constructor signature change (for example when <code class="computeroutput"><span class="identifier">logic</span></code> and <code class="computeroutput"><span class="identifier">logger</span></code>
            parameters order would be swapped)
          </li>
<li class="listitem">
            Allow to easily test smart pointers (verifying destruction call automatically)
            as well as allows to test <code class="computeroutput"><span class="identifier">unique_ptr</span></code>
          </li>
<li class="listitem">
            Automatically manage mocks lifetime
          </li>
<li class="listitem">
            Less boilerplate code
          </li>
</ul></div>
<p>
        To learn more about <code class="computeroutput"><span class="identifier">Automatic</span> <span class="identifier">Mocks</span> <span class="identifier">Injector</span></code>
        see <a class="link" href="../">Extensions section</a>.
      </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="boost_di__dependency_injection_.testing.integration_tests"></a><a class="link" href="testing.html#boost_di__dependency_injection_.testing.integration_tests" title="Integration Tests">Integration
      Tests</a>
</h3></div></div></div>
<p>
        Integration tests usually will require building whole hierarchy of objects.
        However some fakes might be required as well for example to fake data base
        calls. With <code class="computeroutput"><span class="identifier">Boost</span><span class="special">.</span><span class="identifier">DI</span></code> we can achieve such functionality in
        few ways.
      </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
            Fake modules configuration
          </li></ul></div>
<p>
        Example application configuration.
</p>
<pre class="programlisting"><span class="keyword">class</span> <span class="identifier">module</span> <span class="special">{</span>
<span class="keyword">public</span><span class="special">:</span>
    <span class="keyword">auto</span> <span class="identifier">configure</span><span class="special">()</span> <span class="keyword">const</span> <span class="special">{</span>
        <span class="keyword">return</span> <span class="identifier">di</span><span class="special">::</span><span class="identifier">make_injector</span><span class="special">(</span>
            <span class="identifier">di</span><span class="special">::</span><span class="identifier">bind</span><span class="special">&lt;</span><span class="identifier">ilogger</span><span class="special">,</span> <span class="identifier">logger</span><span class="special">&gt;()</span>
          <span class="special">,</span> <span class="identifier">di</span><span class="special">::</span><span class="identifier">bind</span><span class="special">&lt;</span><span class="identifier">idb</span><span class="special">,</span> <span class="identifier">db</span><span class="special">&gt;()</span>
          <span class="special">,</span> <span class="identifier">di</span><span class="special">::</span><span class="identifier">bind</span><span class="special">&lt;</span><span class="identifier">ilogic</span><span class="special">,</span> <span class="identifier">logic</span><span class="special">&gt;()</span>
          <span class="special">,</span> <span class="identifier">di</span><span class="special">::</span><span class="identifier">bind</span><span class="special">&lt;</span><span class="identifier">iuser</span><span class="special">,</span> <span class="identifier">user</span><span class="special">&gt;()</span>
        <span class="special">);</span>
    <span class="special">}</span>
<span class="special">};</span>

<span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span> <span class="special">{</span>
    <span class="identifier">di</span><span class="special">::</span><span class="identifier">make_injector</span><span class="special">(</span><span class="identifier">module</span><span class="special">()).</span><span class="identifier">create</span><span class="special">&lt;</span><span class="identifier">app</span><span class="special">&gt;();</span>
    <span class="keyword">return</span> <span class="number">0</span><span class="special">;</span>
<span class="special">}</span>
</pre>
<p>
      </p>
<p>
        Testing module with fake <code class="computeroutput"><span class="identifier">logger</span></code>
        and <code class="computeroutput"><span class="identifier">db</span></code>, but original <code class="computeroutput"><span class="identifier">logic</span></code> and <code class="computeroutput"><span class="identifier">user</span></code>.
</p>
<pre class="programlisting"><span class="keyword">class</span> <span class="identifier">fake_module</span> <span class="special">{</span>
<span class="keyword">public</span><span class="special">:</span>
    <span class="keyword">auto</span> <span class="identifier">configure</span><span class="special">()</span> <span class="keyword">const</span> <span class="special">{</span>
        <span class="keyword">return</span> <span class="identifier">di</span><span class="special">::</span><span class="identifier">make_injector</span><span class="special">(</span>
            <span class="identifier">di</span><span class="special">::</span><span class="identifier">bind</span><span class="special">&lt;</span><span class="identifier">ilogger</span><span class="special">,</span> <span class="identifier">fake_logger</span><span class="special">&gt;()</span>
          <span class="special">,</span> <span class="identifier">di</span><span class="special">::</span><span class="identifier">bind</span><span class="special">&lt;</span><span class="identifier">idb</span><span class="special">,</span> <span class="identifier">fake_db</span><span class="special">&gt;()</span>
        <span class="special">);</span>
    <span class="special">}</span>
<span class="special">};</span>

<span class="keyword">void</span> <span class="identifier">test_app</span><span class="special">()</span> <span class="special">{</span>
    <span class="keyword">auto</span> <span class="identifier">sut</span> <span class="special">=</span> <span class="identifier">di</span><span class="special">::</span><span class="identifier">make_injector</span><span class="special">(</span><span class="identifier">module</span><span class="special">(),</span> <span class="identifier">fake_module</span><span class="special">()).</span><span class="identifier">create</span><span class="special">&lt;</span><span class="identifier">app</span><span class="special">&gt;();</span>
    <span class="comment">// test sut...</span>
<span class="special">}</span>
</pre>
<p>
      </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
            Write custom allocator which automatically inject fakes for specified
            components with binding integration. See <a class="link" href="../">Automatic
            Mocks Injector</a> for further information.
          </li></ul></div>
<p>
        Example user interface may looks like that.
</p>
<pre class="programlisting"><span class="keyword">void</span> <span class="identifier">test_app</span><span class="special">()</span> <span class="special">{</span>
    <span class="keyword">auto</span> <span class="identifier">injector</span> <span class="special">=</span> <span class="identifier">di</span><span class="special">::</span><span class="identifier">make_injector</span><span class="special">(</span>
        <span class="identifier">module</span><span class="special">()</span>
      <span class="special">,</span> <span class="identifier">di</span><span class="special">::</span><span class="identifier">fake</span><span class="special">&lt;</span><span class="identifier">ilogger</span><span class="special">&gt;()</span>
      <span class="special">,</span> <span class="identifier">di</span><span class="special">::</span><span class="identifier">fake</span><span class="special">&lt;</span><span class="identifier">idb</span><span class="special">&gt;()</span>
    <span class="special">);</span>

    <span class="keyword">auto</span> <span class="identifier">sut</span> <span class="special">=</span> <span class="identifier">injector</span><span class="special">.</span><span class="identifier">allocate</span><span class="special">&lt;</span><span class="identifier">app</span><span class="special">&gt;(</span><span class="identifier">test_allocator</span><span class="special">());</span>

    <span class="comment">// test sut...</span>
<span class="special">}</span>
</pre>
<p>
      </p>
</div>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2014 Krzysztof Jusiak<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="policies.html"><img src=".././doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src=".././doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src=".././doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="examples.html"><img src=".././doc/src/images/next.png" alt="Next"></a>
</div>
</body>
</html>
