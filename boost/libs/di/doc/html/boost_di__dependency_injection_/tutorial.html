<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>Tutorial</title>
<link rel="stylesheet" href="../../../../../doc/src/boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.78.0">
<link rel="home" href="../index.html" title="Boost.DI (Dependency Injection) 1.0">
<link rel="up" href="../index.html" title="Boost.DI (Dependency Injection) 1.0">
<link rel="prev" href="overview.html" title="Overview">
<link rel="next" href="concepts.html" title="Concepts">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr>
<td valign="top"><img alt="Boost C++ Libraries" width="277" height="86" src="../../../../../boost.png"></td>
<td align="center"><a href="../../../../../index.html">Home</a></td>
<td align="center"><a href="../../../../../libs/libraries.htm">Libraries</a></td>
<td align="center"><a href="http://www.boost.org/users/people.html">People</a></td>
<td align="center"><a href="http://www.boost.org/users/faq.html">FAQ</a></td>
<td align="center"><a href="../../../../../more/index.htm">More</a></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="overview.html"><img src="../../../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src="../../../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../../../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="concepts.html"><img src="../../../../../doc/src/images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="boost_di__dependency_injection_.tutorial"></a><a class="link" href="tutorial.html" title="Tutorial">Tutorial</a>
</h2></div></div></div>
<p>
      For the purposes of this tutorial we are going to implement simple application
      which will print log "hello_world" using our logger implementation
      from introduction when first command line argument is not equal 0.
    </p>
<div class="informaltable"><table class="table">
<colgroup><col></colgroup>
<tbody><tr><td>
              <p>
                Logger/Fake logger implementation: <a href="../example/cpp_14/tutorial/ilogger.hpp" target="_top">example/cpp_14/tutorial/ilogger.hpp</a>
                | <a href="../example/cpp_14/tutorial/logger.hpp" target="_top">example/cpp_14/tutorial/logger.hpp</a>
                | <a href="../example/cpp_14/tutorial/fake_logger.hpp" target="_top">example/cpp_14/tutorial/fake_logger.hpp</a>
              </p>
            </td></tr></tbody>
</table></div>
<p>
      Having logger in place let's write basic implementation. Let's assume we have
      test written already, so let's focus on the <code class="computeroutput"><span class="identifier">app</span></code>
      then.
    </p>
<p>
      So, the first step would be to define <code class="computeroutput"><span class="identifier">app</span></code>
      class. There is nothing special about it which is required by Boost.DI, no
      macros, no registration, nothing.
    </p>
<p>
</p>
<pre class="programlisting"><span class="keyword">class</span> <span class="identifier">app</span> <span class="special">{</span>
<span class="keyword">public</span><span class="special">:</span>
    <span class="identifier">app</span><span class="special">(</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">shared_ptr</span><span class="special">&lt;</span><span class="identifier">ilogger</span><span class="special">&gt;</span> <span class="identifier">logger</span><span class="special">,</span> <span class="keyword">int</span> <span class="identifier">value</span><span class="special">)</span>
        <span class="special">:</span> <span class="identifier">logger_</span><span class="special">(</span><span class="identifier">logger</span><span class="special">),</span> <span class="identifier">value_</span><span class="special">(</span><span class="identifier">value</span><span class="special">)</span>
    <span class="special">{</span> <span class="special">}</span>

    <span class="keyword">void</span> <span class="identifier">run</span><span class="special">()</span> <span class="special">{</span>
        <span class="keyword">if</span> <span class="special">(</span><span class="identifier">value_</span><span class="special">)</span> <span class="special">{</span>
            <span class="identifier">logger_</span><span class="special">-&gt;</span><span class="identifier">log</span><span class="special">(</span><span class="string">"hello world"</span><span class="special">);</span>
        <span class="special">}</span>
    <span class="special">}</span>

<span class="keyword">private</span><span class="special">:</span>
    <span class="identifier">std</span><span class="special">::</span><span class="identifier">shared_ptr</span><span class="special">&lt;</span><span class="identifier">ilogger</span><span class="special">&gt;</span> <span class="identifier">logger_</span><span class="special">;</span>
    <span class="keyword">int</span> <span class="identifier">value_</span> <span class="special">=</span> <span class="number">0</span><span class="special">;</span>
<span class="special">};</span>
</pre>
<p>
    </p>
<p>
      After this is completed we would like to create our <code class="computeroutput"><span class="identifier">app</span></code>.
      This step will be different than usual, because we are going to use dependency
      injection framework to create our dependencies for us. We are going to apply
      composition root in our example application and start the app class.
    </p>
<p>
      Remember to include DI header and alias the <code class="computeroutput"><span class="identifier">di</span></code>
      namespace.
</p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">di</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>

<span class="keyword">namespace</span> <span class="identifier">di</span> <span class="special">=</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">di</span><span class="special">;</span>
</pre>
<p>
    </p>
<p>
</p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">di</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>

<span class="keyword">namespace</span> <span class="identifier">di</span> <span class="special">=</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">di</span><span class="special">;</span>

<span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span> <span class="special">{</span>
    <span class="keyword">auto</span> <span class="identifier">injector</span> <span class="special">=</span> <span class="identifier">di</span><span class="special">::</span><span class="identifier">make_injector</span><span class="special">(</span>
        <span class="identifier">di</span><span class="special">::</span><span class="identifier">bind</span><span class="special">&lt;</span><span class="identifier">ilogger</span><span class="special">,</span> <span class="identifier">logger</span><span class="special">&gt;()</span>
    <span class="special">);</span>

    <span class="identifier">injector</span><span class="special">.</span><span class="identifier">create</span><span class="special">&lt;</span><span class="identifier">app</span><span class="special">&gt;().</span><span class="identifier">run</span><span class="special">();</span>

    <span class="keyword">return</span> <span class="number">0</span><span class="special">;</span>
<span class="special">}</span>
</pre>
<p>
    </p>
<p>
      Thats all, our application should compile and don't print anything. 'flag'
      should be false and 'text' should be an empty string.
    </p>
<div class="informaltable"><table class="table">
<colgroup><col></colgroup>
<tbody><tr><td>
              <p>
                Full code example: <a href="../example/cpp_14/tutorial/tutorial1.cpp" target="_top">example/cpp_14/tutorial/tutorial1.cpp</a>
              </p>
            </td></tr></tbody>
</table></div>
<p>
      So far everything seems to be really easy, so the next step will be to configure
      our dependencies, meaning what exactly will be passed to the application. We
      will do it using make_injector functionality. Let's say we would like to print
      "hello world" if first command line argument is not equal 0.
    </p>
<p>
      First step will be to configure the text and value. To demonstrate different
      between static(compile time) values and externals(given by client) we set the
      value to 1 for now:
    </p>
<p>
</p>
<pre class="programlisting"><span class="keyword">auto</span> <span class="identifier">injector</span> <span class="special">=</span> <span class="identifier">di</span><span class="special">::</span><span class="identifier">make_injector</span><span class="special">(</span>
    <span class="identifier">di</span><span class="special">::</span><span class="identifier">bind_int</span><span class="special">&lt;</span><span class="number">1</span><span class="special">&gt;()</span> <span class="comment">// static value</span>
  <span class="special">,</span> <span class="identifier">di</span><span class="special">::</span><span class="identifier">bind</span><span class="special">&lt;</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&gt;::</span><span class="identifier">to</span><span class="special">(</span><span class="string">"hello world"</span><span class="special">)</span> <span class="comment">// dynamic value</span>
<span class="special">);</span>
</pre>
<p>
    </p>
<div class="informaltable"><table class="table">
<colgroup><col></colgroup>
<tbody><tr><td>
              <p>
                Full code example: <a href="../example/cpp_14/tutorial/tutorial2.cpp" target="_top">example/cpp_14/tutorial/tutorial2.cpp</a>
              </p>
            </td></tr></tbody>
</table></div>
<p>
      So, right now we have injector configured and the output of our example application
      should always be "hello world".
    </p>
<p>
      Let's continue then with our requirement that text should be displayed if first
      command line argument is not equal 0.
    </p>
<p>
</p>
<pre class="programlisting"><span class="keyword">int</span> <span class="identifier">main</span><span class="special">(</span><span class="keyword">int</span> <span class="identifier">argc</span><span class="special">,</span> <span class="keyword">char</span><span class="special">**</span> <span class="identifier">argv</span><span class="special">)</span> <span class="special">{</span>
    <span class="keyword">auto</span> <span class="identifier">injector</span> <span class="special">=</span> <span class="identifier">di</span><span class="special">::</span><span class="identifier">make_injector</span><span class="special">(</span>
        <span class="identifier">di</span><span class="special">::</span><span class="identifier">bind</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">&gt;::</span><span class="identifier">to</span><span class="special">(</span><span class="identifier">argc</span> <span class="special">&gt;</span> <span class="number">1</span> <span class="special">?</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">atoi</span><span class="special">(</span><span class="identifier">argv</span><span class="special">[</span><span class="number">1</span><span class="special">])</span> <span class="special">:</span> <span class="number">0</span><span class="special">)</span>
      <span class="special">,</span> <span class="identifier">di</span><span class="special">::</span><span class="identifier">bind</span><span class="special">&lt;</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&gt;::</span><span class="identifier">to</span><span class="special">(</span><span class="string">"hello world"</span><span class="special">)</span>
    <span class="special">);</span>
    <span class="identifier">injector</span><span class="special">.</span><span class="identifier">create</span><span class="special">&lt;</span><span class="identifier">app</span><span class="special">&gt;().</span><span class="identifier">start</span><span class="special">();</span>
<span class="special">}</span>
</pre>
<p>
    </p>
<div class="informaltable"><table class="table">
<colgroup><col></colgroup>
<tbody><tr><td>
              <p>
                Full code example: <a href="../example/cpp_14/tutorial/tutorial3.cpp" target="_top">example/cpp_14/tutorial/tutorial3.cpp</a>
              </p>
            </td></tr></tbody>
</table></div>
<p>
      Great! Seems like our example application is working the way was required.
    </p>
<p>
      But well, we aren't happy with that example, are we? Since we haven't written
      the test for it and we would like to do it right now we have just noticed that
      is hard to mock std::cout, how are we going to test it then? Hmm, maybe helper
      class would be useful? Let's do it then.
    </p>
<p>
</p>
<pre class="programlisting"><span class="keyword">class</span> <span class="identifier">iprinter</span>
<span class="special">{</span>
<span class="keyword">public</span><span class="special">:</span>
    <span class="keyword">virtual</span> <span class="special">~</span><span class="identifier">iprinter</span><span class="special">()</span> <span class="special">{</span> <span class="special">}</span>
    <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="identifier">print</span><span class="special">(</span><span class="keyword">const</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&amp;)</span> <span class="special">=</span> <span class="number">0</span><span class="special">;</span>
<span class="special">};</span>

<span class="keyword">class</span> <span class="identifier">printer</span> <span class="special">:</span> <span class="keyword">public</span> <span class="identifier">iprinter</span>
<span class="special">{</span>
<span class="keyword">public</span><span class="special">:</span>
    <span class="keyword">void</span> <span class="identifier">print</span><span class="special">(</span><span class="keyword">const</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&amp;</span> <span class="identifier">s</span><span class="special">)</span> <span class="identifier">override</span> <span class="special">{</span>
        <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">s</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
    <span class="special">}</span>
<span class="special">};</span>
</pre>
<p>
    </p>
<p>
      Having a printer interface and implementation, we just have to add it to our
      example application:
    </p>
<p>
</p>
<pre class="programlisting"><span class="keyword">class</span> <span class="identifier">app</span>
<span class="special">{</span>
<span class="keyword">public</span><span class="special">:</span>
    <span class="identifier">app</span><span class="special">(</span><span class="keyword">int</span> <span class="identifier">value</span><span class="special">,</span> <span class="keyword">const</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&amp;</span> <span class="identifier">text</span><span class="special">,</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">unique_ptr</span><span class="special">&lt;</span><span class="identifier">printer</span><span class="special">&gt;</span> <span class="identifier">printer</span><span class="special">)</span>
        <span class="special">:</span> <span class="identifier">value_</span><span class="special">(</span><span class="identifier">value</span><span class="special">),</span> <span class="identifier">text_</span><span class="special">(</span><span class="identifier">text</span><span class="special">),</span> <span class="identifier">printer_</span><span class="special">(</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">move</span><span class="special">(</span><span class="identifier">printer</span><span class="special">))</span>
    <span class="special">{</span> <span class="special">}</span>

    <span class="keyword">void</span> <span class="identifier">start</span><span class="special">()</span> <span class="special">{</span>
        <span class="keyword">if</span> <span class="special">(</span><span class="identifier">value_</span><span class="special">)</span>
            <span class="identifier">printer_</span><span class="special">-&gt;</span><span class="identifier">print</span><span class="special">(</span><span class="identifier">text_</span><span class="special">);</span>
    <span class="special">}</span>

<span class="keyword">private</span><span class="special">:</span>
    <span class="keyword">int</span> <span class="identifier">value_</span> <span class="special">=</span> <span class="number">0</span><span class="special">;</span>
    <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span> <span class="identifier">text</span><span class="special">;</span>
    <span class="identifier">std</span><span class="special">::</span><span class="identifier">unique_ptr</span><span class="special">&lt;</span><span class="identifier">printer</span><span class="special">&gt;</span> <span class="identifier">printer_</span><span class="special">;</span>
<span class="special">};</span>
</pre>
<p>
    </p>
<p>
      So what we have to do in order to printer to be created by dependency injection
      framework. Absolutely nothing actually! DI will find out that printer is needed
      and create appropriate instance. So our main function remains the same. Isn't
      that great?
    </p>
<p>
      But wait a minute, shouldn't we pass interface instead? Of course we should,
      we wanted to write a test, so we have to be able to fake printer behavior.
      Let's do some changes then.
    </p>
<p>
</p>
<pre class="programlisting"><span class="identifier">app</span><span class="special">(</span><span class="keyword">int</span> <span class="identifier">value</span><span class="special">,</span> <span class="keyword">const</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&amp;</span> <span class="identifier">text</span><span class="special">,</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">unique_ptr</span><span class="special">&lt;</span><span class="identifier">iprinter</span><span class="special">&gt;</span> <span class="identifier">printer</span><span class="special">)</span>
<span class="special">...</span>
<span class="identifier">std</span><span class="special">::</span><span class="identifier">unique_ptr</span><span class="special">&lt;</span><span class="identifier">iprinter</span><span class="special">&gt;</span> <span class="identifier">printer_</span><span class="special">;</span>
</pre>
<p>
    </p>
<p>
      Hmm, right now our example project isn't compiling, because iprinter can't
      be instantiated due to pure virtual method print not being implemented. Well,
      we have to configure DI the way iprinter will be actually a printer. There
      is nothing easier, we just have to bind iprinter interface to printer implementation.
    </p>
<p>
</p>
<pre class="programlisting"><span class="keyword">auto</span> <span class="identifier">injector</span> <span class="special">=</span> <span class="identifier">di</span><span class="special">::</span><span class="identifier">make_injector</span><span class="special">(</span>
    <span class="identifier">di</span><span class="special">::</span><span class="identifier">bind</span><span class="special">&lt;</span><span class="identifier">iprinter</span><span class="special">,</span> <span class="identifier">printer</span><span class="special">&gt;()</span>
  <span class="special">,</span> <span class="identifier">di</span><span class="special">::</span><span class="identifier">bind</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">&gt;::</span><span class="identifier">to</span><span class="special">(</span><span class="identifier">argc</span> <span class="special">&gt;</span> <span class="number">1</span> <span class="special">?</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">atoi</span><span class="special">(</span><span class="identifier">argv</span><span class="special">[</span><span class="number">1</span><span class="special">])</span> <span class="special">:</span> <span class="number">0</span><span class="special">)</span>
  <span class="special">,</span> <span class="identifier">di</span><span class="special">::</span><span class="identifier">bind</span><span class="special">&lt;</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&gt;::</span><span class="identifier">to</span><span class="special">(</span><span class="string">"hello world"</span><span class="special">)</span>
<span class="special">);</span>
<span class="identifier">injector</span><span class="special">.</span><span class="identifier">create</span><span class="special">&lt;</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">unique_ptr</span><span class="special">&lt;</span><span class="identifier">app</span><span class="special">&gt;&gt;()-&gt;</span><span class="identifier">start</span><span class="special">();</span> <span class="comment">// unique_ptr is not copyable</span>
</pre>
<p>
    </p>
<div class="informaltable"><table class="table">
<colgroup><col></colgroup>
<tbody><tr><td>
              <p>
                Full code example: <a href="../example/cpp_14/tutorial/tutorial4.cpp" target="_top">example/cpp_14/tutorial/tutorial4.cpp</a>
              </p>
            </td></tr></tbody>
</table></div>
<p>
      Yay, everything is working again. But oh, we wanted to use mock framework for
      tests, but we can't to do it, due to unique ptr stilling our pointer :/ Well,
      let's say we will switch to shared_ptr instead. Our application code will looks
      like that:
    </p>
<p>
</p>
<pre class="programlisting"><span class="identifier">app</span><span class="special">(</span><span class="keyword">int</span> <span class="identifier">value</span><span class="special">,</span> <span class="keyword">const</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&amp;</span> <span class="identifier">text</span><span class="special">,</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">shared_ptr</span><span class="special">&lt;</span><span class="identifier">iprinter</span><span class="special">&gt;</span> <span class="identifier">printer</span><span class="special">)</span>
    <span class="special">:</span> <span class="identifier">value_</span><span class="special">(</span><span class="identifier">value</span><span class="special">),</span> <span class="identifier">text_</span><span class="special">(</span><span class="identifier">text</span><span class="special">),</span> <span class="identifier">printer_</span><span class="special">(</span><span class="identifier">printer</span><span class="special">)</span>
<span class="special">{</span> <span class="special">}</span>
<span class="special">...</span>
<span class="identifier">std</span><span class="special">::</span><span class="identifier">shared_ptr</span><span class="special">&lt;</span><span class="identifier">iprinter</span><span class="special">&gt;</span> <span class="identifier">printer_</span><span class="special">;</span>
</pre>
<p>
    </p>
<p>
      Again, we don't have to change anything with the DI configuration, it will
      be figured out automatically for us.
    </p>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../../../../doc/src/images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>
        DI will by default deduce scope based on parameter type, therefore shared_ptr
        will be shared between many instances
      </p></td></tr>
</table></div>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../../../../doc/src/images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>
        If we pass raw pointer anywhere it always be our responsibility to delete
        it, DI will NEVER do it for us
      </p></td></tr>
</table></div>
<p>
      Finally we were able to easy write unit tests for our example application code
      :)
    </p>
<p>
      Yea, but this example is really easy, writing whole configuration within the
      main function is a bit smelly, what to do? Well, we can define module for our
      configuration. Module is a class with <code class="computeroutput"><span class="identifier">configure</span></code>
      method returning dependencies configuration. So, let's do it.
    </p>
<p>
</p>
<pre class="programlisting"><span class="keyword">class</span> <span class="identifier">module</span>
<span class="special">{</span>
<span class="keyword">public</span><span class="special">:</span>
    <span class="keyword">explicit</span> <span class="identifier">module</span><span class="special">(</span><span class="keyword">int</span> <span class="identifier">i</span><span class="special">)</span>
        <span class="special">:</span> <span class="identifier">i_</span><span class="special">(</span><span class="identifier">i</span><span class="special">)</span>
    <span class="special">{</span> <span class="special">}</span>

    <span class="keyword">auto</span> <span class="identifier">configure</span><span class="special">()</span> <span class="keyword">const</span> <span class="special">{</span>
        <span class="keyword">return</span> <span class="identifier">di</span><span class="special">::</span><span class="identifier">make_injector</span><span class="special">(</span>
            <span class="identifier">di</span><span class="special">::</span><span class="identifier">deduce</span><span class="special">&lt;</span><span class="identifier">printer</span><span class="special">&gt;()</span> <span class="comment">// we can deduce the interface as well!</span>
          <span class="special">,</span> <span class="identifier">di</span><span class="special">::</span><span class="identifier">bind</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">&gt;::</span><span class="identifier">to</span><span class="special">(</span><span class="identifier">i_</span><span class="special">)</span>
          <span class="special">,</span> <span class="identifier">di</span><span class="special">::</span><span class="identifier">bind</span><span class="special">&lt;</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&gt;::</span><span class="identifier">to</span><span class="special">(</span><span class="string">"hello world"</span><span class="special">)</span>
        <span class="special">);</span>
    <span class="special">}</span>

<span class="keyword">private</span><span class="special">:</span>
    <span class="keyword">int</span> <span class="identifier">i_</span> <span class="special">=</span> <span class="number">0</span><span class="special">;</span>
<span class="special">};</span>
</pre>
<p>
    </p>
<p>
      and the main function
    </p>
<p>
</p>
<pre class="programlisting"><span class="keyword">int</span> <span class="identifier">main</span><span class="special">(</span><span class="keyword">int</span> <span class="identifier">argc</span><span class="special">,</span> <span class="keyword">char</span><span class="special">**</span> <span class="identifier">argv</span><span class="special">)</span> <span class="special">{</span>
    <span class="keyword">auto</span> <span class="identifier">injector</span> <span class="special">=</span> <span class="identifier">di</span><span class="special">::</span><span class="identifier">make_injector</span><span class="special">(</span><span class="identifier">module</span><span class="special">(</span><span class="identifier">argc</span> <span class="special">&gt;</span> <span class="number">1</span> <span class="special">?</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">atoi</span><span class="special">(</span><span class="identifier">argv</span><span class="special">[</span><span class="number">1</span><span class="special">])</span> <span class="special">:</span> <span class="number">0</span><span class="special">));</span>
    <span class="identifier">injector</span><span class="special">.</span><span class="identifier">create</span><span class="special">&lt;</span><span class="identifier">app</span><span class="special">&gt;().</span><span class="identifier">start</span><span class="special">();</span>

    <span class="keyword">return</span> <span class="number">0</span><span class="special">;</span>
<span class="special">}</span>
</pre>
<p>
    </p>
<p>
      But in our company we use custom string, but we still want to support std::string
      as well, how to do that? Well, we will have to add second constructor accepting
      custom string, but then we have 2 constructors taking 2 parameters, that will
      be ambiguous, how DI will be able to figure out which one to use? Short answer:
      it won't, we will have to point which constructor we want to be used by DI.
      We do it using BOOST_DI_INJECT macro. Let's do it!
    </p>
<p>
</p>
<pre class="programlisting"><span class="keyword">class</span> <span class="identifier">app</span>
<span class="special">{</span>
<span class="keyword">public</span><span class="special">:</span>
    <span class="identifier">BOOST_DI_INJECT</span><span class="special">(</span><span class="identifier">app</span><span class="special">,</span> <span class="keyword">int</span> <span class="identifier">value</span><span class="special">,</span> <span class="keyword">const</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&amp;</span> <span class="identifier">text</span><span class="special">)</span>
        <span class="special">:</span> <span class="identifier">value_</span><span class="special">(</span><span class="identifier">value</span><span class="special">),</span> <span class="identifier">text_</span><span class="special">(</span><span class="identifier">text</span><span class="special">)</span>
    <span class="special">{</span> <span class="special">}</span>

    <span class="identifier">app</span><span class="special">(</span><span class="keyword">int</span> <span class="identifier">value</span><span class="special">,</span> <span class="keyword">const</span> <span class="identifier">our_string</span><span class="special">&amp;</span> <span class="identifier">text</span><span class="special">)</span>
        <span class="special">:</span> <span class="identifier">value_</span><span class="special">(</span><span class="identifier">value</span><span class="special">),</span> <span class="identifier">text_</span><span class="special">(</span><span class="identifier">text</span><span class="special">)</span>
    <span class="special">{</span> <span class="special">}</span>

    <span class="keyword">void</span> <span class="identifier">start</span><span class="special">()</span> <span class="special">{</span>
        <span class="keyword">if</span> <span class="special">(</span><span class="identifier">value_</span><span class="special">)</span>
            <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">print</span><span class="special">(</span><span class="identifier">text_</span><span class="special">)</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
    <span class="special">}</span>

<span class="keyword">private</span><span class="special">:</span>
    <span class="keyword">int</span> <span class="identifier">value_</span> <span class="special">=</span> <span class="number">0</span><span class="special">;</span>
    <span class="identifier">variant</span><span class="special">&lt;</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">,</span> <span class="identifier">our_string</span><span class="special">&gt;</span> <span class="identifier">text_</span><span class="special">;</span>
<span class="special">};</span>
</pre>
<p>
    </p>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../../../../doc/src/images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>
        We don't need to specify BOOST_DI_INJECT if there is a constructor with more
        parameters, DI will always use the longest one
      </p></td></tr>
</table></div>
<p>
      Hmm, so what if I have two command line parameters passed by user, how to distinguish
      them? We have few options in order to do so, some of them are more intrusive
      and some are less. First we can define different types for both of them. We
      can use named parameters like that:
    </p>
<p>
</p>
<pre class="programlisting">    <span class="keyword">class</span> <span class="identifier">first</span> <span class="special">{</span> <span class="special">};</span>
    <span class="keyword">class</span> <span class="identifier">second</span> <span class="special">{</span> <span class="special">};</span>
<span class="special">...</span>
    <span class="identifier">app</span><span class="special">(</span><span class="identifier">named</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">,</span> <span class="identifier">first</span><span class="special">&gt;</span> <span class="identifier">value1</span><span class="special">,</span> <span class="identifier">named</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">,</span> <span class="identifier">second</span><span class="special">&gt;</span> <span class="identifier">value2</span><span class="special">,</span> <span class="keyword">const</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&amp;</span> <span class="identifier">text</span><span class="special">)</span>
</pre>
<p>
    </p>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../../../../doc/src/images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>
        named parameters will convert to the type there are named from, meaning -
        you can write: <code class="computeroutput"><span class="keyword">int</span> <span class="identifier">value</span>
        <span class="special">=</span> <span class="identifier">named</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">,</span>
        <span class="identifier">first</span><span class="special">&gt;(</span><span class="number">42</span><span class="special">)</span></code>
      </p></td></tr>
</table></div>
<p>
      The last option is less intrusive and uses traits to achieve named parameters.
    </p>
<p>
</p>
<pre class="programlisting">    <span class="identifier">app</span><span class="special">(</span><span class="keyword">int</span> <span class="identifier">value1</span><span class="special">,</span> <span class="keyword">int</span> <span class="identifier">value2</span><span class="special">,</span> <span class="keyword">const</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&amp;</span> <span class="identifier">text</span><span class="special">)</span>

<span class="special">...</span>

    <span class="keyword">namespace</span> <span class="identifier">boost</span> <span class="special">{</span>
    <span class="keyword">namespace</span> <span class="identifier">di</span> <span class="special">{</span>

    <span class="keyword">template</span><span class="special">&lt;&gt;</span>
    <span class="keyword">struct</span> <span class="identifier">ctor_traits</span><span class="special">&lt;</span><span class="identifier">app</span><span class="special">&gt;</span>
    <span class="special">{</span>
        <span class="identifier">BOOST_DI_INJECT_TRAITS</span><span class="special">(</span><span class="identifier">named</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">,</span> <span class="identifier">first</span><span class="special">&gt;,</span> <span class="identifier">named</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">,</span> <span class="identifier">second</span><span class="special">&gt;,</span> <span class="keyword">const</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&amp;);</span>
    <span class="special">};</span>

    <span class="special">}}</span> <span class="comment">//boost::di</span>
</pre>
<p>
    </p>
<div class="tip"><table border="0" summary="Tip">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="../../../../../doc/src/images/tip.png"></td>
<th align="left">Tip</th>
</tr>
<tr><td align="left" valign="top"><p>
        BOOST_DI_INJECT_TRAITS might be defined within a class as well
      </p></td></tr>
</table></div>
<p>
      That's pretty much it. Hope this tutorial helped you a bit to understand basics
      concept of dependency injection framework and that creation dependencies won't
      be a problem for you anymore.
    </p>
<p>
      Right now you can move on to more in depth stuff - concepts - or just straight
      away to examples.
    </p>
<div class="informaltable"><table class="table">
<colgroup><col></colgroup>
<tbody><tr><td>
              <p>
                Full code example: <a href="../example/cpp_14/tutorial/tutorial5.cpp" target="_top">example/cpp_14/tutorial/tutorial5.cpp</a>
              </p>
            </td></tr></tbody>
</table></div>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2014 Krzysztof Jusiak<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="overview.html"><img src="../../../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src="../../../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../../../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="concepts.html"><img src="../../../../../doc/src/images/next.png" alt="Next"></a>
</div>
</body>
</html>
